<?php

class AcquiaQACommentTest extends DrupalWebTestCase {

  public static function getInfo() {
    return array(
      'name' => 'Acquia QA Test',
      'description' => 'Set of Tests to be used in Acquia QA Training',
      'group' => 'Acquia'
    );
  }

  function setUp() {
    parent::setUp('comment');
    
    $this->privileged_user = $this->drupalCreateUser(array('view published content', 'post comments', 'create article content'));
    $this->lessprivilegeduser = $this->drupalCreateUser('view published content');
    //$this->drupalLogin($this->privileged_user);
  }

  /**
   * Post comment.
   *
   * @param $node
   *   Node to post comment on.
   * @param $comment
   *   Comment body.
   * @param $subject
   *   Comment subject.
   */
  function postComment($node, $comment, $subject = '') {
    $langcode = LANGUAGE_NONE;
    $edit = array();
    $edit['comment_body[' . $langcode . '][0][value]'] = $comment;
    $edit['subject'] = $subject;
    $this->drupalPost(NULL, $edit, t('Save'));

    $match = array();
    // Get comment ID
    preg_match('/#comment-([0-9]+)/', $this->getURL(), $match);
    if (isset($match[1])) {
      return (object) array('id' => $match[1], 'subject' => $subject, 'comment' => $comment);
    }
  }

  function testPostingComments() {
    
  }

  function testDeletingComment() {
  }

  // Challenge:
  function testCommentPermissions() {
    // run the above posting method using different users.
  }

}

